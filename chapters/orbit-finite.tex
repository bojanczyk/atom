\chapter{Orbit-finite sets}
\label{cha:orbit-finite-equality}

So far, we have worked with polynomial orbit-finite sets, which had an elementary and concrete definition, but were enough to describe many interesting examples of automata and other computational models. However, as we will show in this chapter,  pof lack certain closure properties, which are necessary for some applications, such as minimisation of automata. To overcome this limitation,  we introduce in this chapter a  generalisation of pof sets, namely the (not necessarily polynomial) orbit-finite sets.
This generalisation can be described using two approaches, which turn out to be equivalent.
\begin{itemize}
    \item The first approach, which is described in Section~\ref{sec:subquotiented-pof-sets}, is more syntactic. It  extends pof sets with two features, namely subsets and quotients.
    \item The second approach, which is described in Section~\ref{sec:orbit-finiteness-equality}, is more  semantic. It is described using the abstract language of group actions. 
\end{itemize}
Each of the two approaches has its own advantages. The syntactic approach is more concrete and easy to understand. It is also automatically equipped with a finite representation, which will allow us to use algorithms on orbit-finite sets. A disadvantage of the syntactic approach is that it may seem a bit arbitrary. The reader might ask: why are subsets and quotients the only feature that needs to be added? This disadvantage of the syntactic approach is addressed by its equivalence with the semantic approach, which does not raise such questions. Also, in some applications, the semantic approach will be more useful from a technical point of view. For example, in   the Myhill-Nerode Theorem from Section~\ref{sec:myhill-nerode-equality}, we will use the  semantic approach, since only the semantic structure will be readily available under the assumptions of the theorem.


\section{Subquotients}
\label{sec:subquotiented-pof-sets}
We begin with a description of the syntactic approach, which uses two closure properties, namely subsets and quotients. 
Since this book is inspired by automata applications, we  use minimisation of deterministic automata as a motivation for these closure properties.  

The classical minimisation construction restricts the state space of a deterministic automaton to  the subset of reachable states, and then it quotients this subset under the  equivalence relation defined by 
\begin{align*}
q \sim p \qquad \eqdef \qquad qw \in F \Leftrightarrow pw \in F \text{ for every word $w \in \Sigma^*$},
\end{align*}
where $qw$ is the state that is reached after reading the word $w$ from the state $q$. Therefore, the resulting set of states will be a quotient of a subset of the original state space. This motivates the following definition, which captures the syntactic approach to orbit-finite sets.

\begin{definition}[Subquotiented pof sets]
    A subquotient of a pof set $X$ is any set that is obtained as follows.
    \begin{itemize}
        \item First, take an equivariant subset $Y \subseteq X$.
        \item Next, take an equivariant equivalence relation $\sim$ on $Y$.
    \end{itemize}
    The subquotient is then defined to be the family of equivalence classes of $\sim$. We use the name subquotiented pof set, or ""spof set"" for short, for any set of this form.
\end{definition}

At the moment, it is not clear why the above definition captures orbit-finiteness. It is not hard to see that spof sets have finitely many orbits, since this is the case for pof sets, and subquotients can only decrease the number of orbits. However, the converse implication is less apparent: why should every set with finitely many orbits be a spof set? This question will be addressed in the next section, Section~\ref{sec:orbit-finiteness-equality}, where we discuss orbits in a more abstract way, and show that spof sets are indeed expressively complete. For the moment, however, we work with the syntactic definition, without worrying about completeness. 
% It is not hard to see, and will be shown later in this chapter,  that a subset of quotient is a quotient of a subset. Therefore, "spof sets" are closed under taking both subsets and quotients, and there is no need to further iterate the operations. 
 The rest of this section is devoted to discussion of their properties and examples, mainly motivated by automata applications.

\begin{myexample}[Subsets]
Consider the    set of non-repeating tuples
\begin{align*}
\atoms^{(d)} 
\quad  = \quad 
\setbuild{(a_1,\ldots,a_d) \in \atoms^d}{$a_1,\ldots,a_d$ are pairwise different}
\end{align*}
that was introduced in Example~\ref{ex:pof-product-generating-set}. This is an equivariant subset of the pof set $\atoms^d$,  but it is not a pof set on its own. This example is particularly important, since every orbit in a pof set is of this kind, up to an equivariant bijection.     
\end{myexample}
 
\begin{myexample}[Quotients] Consider the equivalence relation $\sim$ on $\atoms^d$, which identifies two tuples if one is a permutation of the other. The corresponding quotient describes multisets: an equivalence class in the quotient is  the same as a multiset of exactly $d$ atoms. Recall that a multiset is an unordered list that can have repeated elements. 
\end{myexample}

\begin{myexample}
    [Subquotients]  Consider the  set of unordered tuples 
\begin{align*}
{\atoms \choose d} 
\quad \eqdef \quad
\setbuild{\set{a_1,\ldots,a_d}}{$a_1,\ldots,a_d$ are pairwise different}.
\end{align*}
This set can be obtained from $\atoms^d$ by first restricting to the subset of non-repeating pairs, and then quotienting under the equivalence relation that identifies two tuples if they are a permutation of each other.
\end{myexample}



In the following example, we show how "spof sets" are used in minimisation. 



\begin{myexample}\label{ex:pof-dont-minimize}[Minimisation]
    Consider the language
    \begin{align*}
    L = \setbuild{w \in \atoms^*}{\text{$w$ uses at most two different atoms}}.
    \end{align*}
    This language has a pof alphabet, without any subquotients, and it is recognised by a pof automaton, again without subquotients,  which has a state space 
    \begin{align*}
        \myunderbrace{\atoms^0+\atoms^1 + \atoms^2}{atoms seen so far}
        \quad + \quad 
        \myunderbrace{\atoms^0}{reject}.
    \end{align*}
    Nevertheless, as we will show in this example, minimisation for this automaton will require using subquotients.
    This automaton is not minimal for two reasons: (1) repeating pairs $(a,a)$ in the component $\atoms^2$ are never reached; and (2)  the states from $\atoms^2$ store the order in a pair $(a,b)$, which is not needed for the language. Both of these reasons are addressed by using subquotients.
     To make this automaton minimal, we should use a state space of the form
    \begin{align*}
    \atoms^0 + \atoms^1 + 
    \myunderbrace{\atoms \choose 2}{sets of exactly two atoms, as described \\ at the beginning of this chapter } + \atoms^0.
    \end{align*}
    This state space is a spof set, but it is not a pof set. 
    
    Let us show that subquotients are necessary more formally. Consider a deterministic pof automaton for this language, without subquotients. We will  show  the states after reading the input words $ab$ and $ba$ must be different, while they should be equal in a minimal automaton. Indeed, if the same state $q$ would be reached after reading both $ab$ and $ba$,  then this state would satisfy 
    \begin{align*}
    \pi(q) = q \qquad \text{where $\pi$ is the atom permutation that swaps $a$ and $b$}.
    \end{align*}
    If an element in a pof set satisfies the above condition, then it cannot use the atoms $a$ and $b$. This cannot happen in an automaton that recognises the language.
\end{myexample}

% In this chapter, we overcome these limitations, by introducing the notion of (not necessarily polynomial) orbit-finite sets. This notion is defined using the abstract language  of group actions, which may seem at first glance to be excessively formalistic. However, as we will see later in this book, the added generality has many advantages. Also, the same notion can be described in more concrete terms, such as the closure of pof sets under equivariant subsets and quotients.


% If we would like our automata to be closed under minimization, then they should support taking subsets and quotients. A quick and dirty solution is to simply add these two features. We will describe this solution in Section~\ref{sec:subquotiented-pof-sets}. Later in this chapter, we will show that the solution is not so dirty after all, and it can be equivalently described in a more abstract way, using the language of group actions. Later in the book, other ways of describing the notion will also appear, namely the representable sets from Chapter~\ref{cha:sets-of-sets-of-sets}, thus inspiring confidence that the notion is well motivated.

In the above example, we used a subquotient to create a minimal automaton. However, once we have authorised spof sets, we can start using them as input alphabets, and define new languages for them, which will lead us to interesting examples of automata. Before discussing these examples, we need to define equivariance for spof sets, since all the structure in the automata will be required to be equivariant. There are no surprises for this definition: a subset $Y$ of a spof set $X$ is called equivariant if it is invariant under applying atom permutations, i.e.
\begin{align*}
y \in Y 
\quad \Leftrightarrow \quad
\pi(y) \in Y 
\quad \text{for every atom permutation $\pi$}.
\end{align*}
In order for this definition be meaningful, we need to explain what $\pi(y)$ is, i.e.~how atom permutations are applied to elements of a spof set.  This is done in the natural way. Since an element of a spof set is an equivalence class, an atom permutation is applied to it by taking the image of the equivalence class. The following straightforward lemma shows that the image will also be an equivalence class in the spof set, which ensures that $\pi(y)$ is well-defined. 

\begin{lemma}
    Let $X$ be a spof set. If $\pi$ is an atom permutation and $x \in X$, then $\pi(x) \in X$.
\end{lemma}
\begin{proof}
        By definition,  the spof set $X$ is obtained by starting with a pof set, call it $Z$, and taking a quotient with respect to some equivariant relation $\sim$ that is defined on some equivariant subset of $Z$. 
        Take an element $x \in X$. This element is the equivalence class of some representative $z \in Z$ in the original pof set. By equivariance of $\sim$, we know 
        \begin{align*}
        z' \sim z
        \quad \Leftrightarrow \quad
        \pi(z') \sim \pi(z) 
        \qquad \text{for every $z' \in Z$}.
        \end{align*}
        Therefore, the  same result is obtained by: (a) first taking the equivalence class of the representative $z$ and then applying $\pi$ to all elements of this equivalence class; or (b) first applying $\pi$ to the representative $z$, and then taking its equivalence class.         The result of (a)  is equal to $\pi(x)$, by definition of how $\pi$ is applied to elements of $X$. The result of (a) is an element of $X$, since the $\pi(z)$ is guaranteed to be in the domain of the equivalence relation $\sim$. 
\end{proof}

In the case of pof sets, we defined equivariant functions as the special case of equivariant relations, and we defined equivariant relations as the special case of subsets of products. This approach extends to spof sets, using the following straightforward lemma, whose proof is left as an exercise for the reader. 
    \begin{lemma}
    Spof sets are closed under disjoint unions $X + Y$ and products $X \times Y$.
\end{lemma}
By thinking of functions and relations as subsets of products, we can now speak of equivariant functions and relations on spof sets. One of the interesting properties of equivariant functions is that symmetries on the input must be reflected in the output, which will prohibit certain functions, as shown in the following example.

\begin{myexample}[Choice fails]\label{ex:choice-spof}
    We will show that there is no "equivariant" function 
    \begin{align*}
    f : {\atoms \choose 2} \to \atoms.
    \end{align*}
    In other words, one cannot choose an atom from a set of size two, in an equivariant way.
    In this proof, we treat elements of $\atoms \choose 2$ as sets $\set{a,b}$ of size two, although formally they are defined to be equivalence classes of ordered pairs.  Consider some hypothetical function $f$, and some  input-output pair 
    \begin{align*}
        f(\set{a,b})=c.
    \end{align*}
    We first rule out the case that $c \not \in \set{a,b}$. If this were the case, then  we could apply an  atom permutation to the input-output pair that moves $c$ without moving $a$ and $b$, and get a violation of functionality. Let us now rule out the case $c \in \set{a,b}$. If this were the case, then we could apply an atom permutation that swaps $a$ and $b$; this atom permutation would not change the input, but it would change the output, and so it would also be a violation of functionality. 
\end{myexample}


 We finish this section with two examples of deterministic spof automata, i.e.~deterministic automata where the input alphabet and state space are spof sets, and the remaining structure is equivariant. 

\begin{myexample}[Intersecting letters] In this example we show that once a subquotient is used in the input alphabet, then it will also be necessary in the state space of a deterministic automaton, even if we do not insist on minimality. 
    
    Let $d \in \set{1,2,\ldots}$ and  consider the language 
    \begin{align*}
    \setbuild { w \in {\atoms \choose d}^*}{there is an atom that appears in every letter}.
    \end{align*}
    In other words, this language consists of words, where the intersection of all letters is a nonempty set. We will show a deterministic automaton that recognises this language, although the states of this automaton will also use subquotients. The automaton stores the intersection of letters seen so far. Its state space is therefore 
    \begin{align*}
    \myunderbrace{\atoms^0}{initial}
    \quad + \quad 
    {\atoms \choose {\leq d}},
    \end{align*}
    where the second summand describes possibly empty sets with at most $d$ atoms. Upon reading the first letter, the automaton loads it into its state. Then, it keeps on intersecting the state with each new input letter. The accepting states are all states, except the initial state and the empty set in the second summand.

    The automaton described above uses subquotients. In the presence of nondeterminism, we could avoid this, and have a state space that is a pof set without subquotients. Th state space would be 
    \begin{align*}
    \myunderbrace{\atoms^0}{initial}
    \quad + \quad 
    \myunderbrace{
        \atoms^d + \atoms^{d-1} + \cdots + \atoms^0}
    {intersection of letters seen so far}.
    \end{align*}
    Upon reading the first letter, the automaton would nondeterministically choose some order on the atoms appearing in this letter, and put the corresponding tuple of atoms into a state of the form $\atoms^d$. Then, it would start removing atoms from this tuple that do not appear in subsequent letters, leading to rejection once the tuple becomes empty. 

    However, as we will now show, subquotients are necessary if we want to use a deterministic automaton. The idea is that the symmetries for the input alphabet impose symmetries for the state space. The main observation is stated in the following claim, which shows that if the state space is a pof set, then the automaton is incapable of putting any atoms into its state. The claim is a variant of the observations from Example~\ref{ex:choice-spof}, which showed that choice fails in the presence of symmetries.
    \begin{claim}
        Let $d > 1$, let  $Q$ be a pof set,  let 
            \begin{align*}
    \delta : Q \times {\atoms \choose d} \to Q 
    \end{align*}
    be an equivariant function, and consider some triple $\delta(p,a)=q$. If $p$ has no atoms, i.e.~it comes from  a component of dimension zero, then the same is true for $q$.
    \end{claim}
    \begin{proof}
        We use the following property of pof sets: (*) if $Q$  is  a pof set, and $\pi$ is an atom permutation that fixes some $q \in Q$, then all atoms which appear in $q$ must be fixed by $\pi$. The reason for this property is that the atoms in a pof set are stored in an ordered list, and therefore moving them will affect the list.  Property (*) is no longer valid in the presence of subquotients, e.g.~the set $\set{\eve, \john}$ is stabled under swapping Eve  and John.

        We use property (*) to prove the claim. 
        Consider an atom permutation $\pi$ which swaps two atoms that appear in the input letter. Such a permutation is possible by the assumption that $d>1$. By equivariance, we can apply this permutation to the transition $\delta(p,a)=q$, and the result should be a new transition. This permutation does not affect the input letter, since the input letter does not care about the order of the atoms. This permutation also does not affect the source state $p$, since this state does not use any atoms. Therefore, by equivariance of the transition function, this permutation should also not affect the target state $q$. (Here we use determinism, i.e.~the fact that $\delta$ is a function.)  Since the set of states is a pof set, we can use the property (*) from the previous paragraph to conclude that none of the atoms from the input letter can be used in the target state. For a similar reason, we can swap atoms that are not in the input letter, and therefore these atoms also cannot appear in the target state.  Summing up, no atoms can appear in the target state. 
    \end{proof}

    Using the above claim, we show that our language cannot be recognised by a deterministic pof automaton without subquotients.
    In a pof automaton, the initial state cannot contain any atoms. Therefore, by the above claim, a deterministic pof automaton would be unable to reach any state that uses atoms. In particular, after reading the first letter, the state would not depend on the contents of this first letter. Since membership in the language clearly depends on the contents of the first letter, it follows that such an automaton cannot recognise the language. 
\end{myexample}

\begin{myexample}[Hitting sets]\label{ex:hitting-set}
    In the previous example, the language required that there is some atom which appears in all input letters. In this example, we present a more interesting automaton, in which the requirement is relaxed: there is a set of two atoms $\set{a,b}$ which is a \emph{hitting set}, i.e.~it has nonempty intersection with every input letter.  Consider the following  language:
    \begin{align*}
    \setbuild{w \in {\atoms \choose 2}^*}{there is a hitting  set of at most two atoms}.
    \end{align*}
    We will show that this language can be recognised by a deterministic automaton, if we allow spof sets. This example can even be (non-trivially) extended to a more general variant, where the input alphabet uses sets of some fixed size $d$, and the hitting set has some other size $e$, see Exercise~\ref{ex:hitting-set-deterministic-generalised}.

    We begin with a nondeterministic automaton. As in the previous example, in the presence of nondeterminism, we can even avoid subquotients. More importantly, the construction is very straightforward: the automaton uses nondeterminism to guess the hitting set. 
    
    The rest of this example is devoted to presenting a deterministic automaton.  The key observation is that after reading three distinct input letters, there are finitely many candidates for the hitting set. These candidates are explained in the following picture (in red), depending on the possible overlaps between the three input letters:
    \mypicb{13}
    Using this observation, we now describe the automaton. 
    
    At the beginning, it  waits for the first three distinct input letters to arrive, which is done using a state space of the form 
        \begin{align*}
    \myunderbrace{{\atoms \choose d}^0 + {\atoms \choose d}^1 + {\atoms \choose d}^2}{at most two distinct letters seen so far}.
        \end{align*}  
    The first component is the initial state. 
    These states are accepting, because there is a  hitting set of size at most two, namely one atom for each letter. Once the three letters have arrived, the automaton computes the finite set of candidates for the hitting set. From then on, it starts reading the input and removing candidates from the set which do not hit the current input letter. Once all candidates are removed, the automaton enters a rejecting state; before this happens the state is accepting. 

    Finally, when the third distinct input letter arrives, the automaton computes the finite set of candidates for the hitting set. As explained in the picture above, these candidates use at most 5 atoms. Therefore, to describe a set of candidates, we need to indicate a set of 5 atoms, and then indicate a family of subsets of size two in this set, which leads to the set 
    \begin{align*}
    \myunderbrace{
       P =   \setbuild{
            \setbuild{X}{$X \subseteq {Y \choose 2}$}
        }{
            $Y \subseteq {\atoms \choose 5}$
        }
    }{sets of candidates for the hitting set}.
    \end{align*}
    This set is somewhat similar to a pof set, in the sense that it is finite up to permutations of the atoms. This is because  once the 5 atoms for the set $Y$ have been chosen, there are finitely ways of choosing the family $X$ of subsets of size two. However, the set $P$ is not a pof set, since it has certain internal symmetries.     Once the third distinct input letter arrives, the automaton computes the set of candidates for the hitting set, which is done using a function 
    \begin{align*}
    f : {\atoms \choose d}^3 \to P,
    \end{align*}
    which is the one that is described in the picture with five cases. The function is partial, since it is only defined on arguments where the three input letters are distinct. More importantly, the function is equivariant. This is left as an exercise for the reader, with the important thing being that the output of $f$ depends only on how the three input sets overlap.
\end{myexample}




\exercisepart
\input{problems/spof-spof}
\section{Orbit-finiteness}
\label{sec:orbit-finiteness-equality}
In the previous section, we defined subquotiented pof sets, with an emphasis on minimisation of deterministic pof automata. 
One could worry that subquotient pof sets are a hack, whose usefulness is limited to the  minimisation problem. In this section, we ease such worries, by giving a more semantic concept, namely orbit-finite sets, and showing that they are exactly the same as subquotiented pof sets.

The general idea is that a set $X$ is orbit-finite if it has finitely many orbits, which means that there are finitely many generators  $x_1,\ldots,x_n \in X$ such that every other element of the set is in the same orbit as one of these generators, i.e.~every element is of the form $\pi(x_i)$ for some atom permutation $\pi$ and some generator $x_i$.  In order to formalise this idea, we need to explain what $\pi(x_i)$ means, i.e.~how we apply an atom permutation to an element of the set $X$. If $X$ constructed using atoms in some natural way, e.g.~it is a subquotiented pof set such as \begin{align*}
\atoms^3 + \atoms^{(2)} + {\atoms \choose 3},
\end{align*}
then the meaning of $\pi(x)$ is clear: we simply apply $\pi$ to all atoms that appear in $x$. However, for an abstract set $X$, it might not be clear what it means for an atom to ``appear'' in an element $x \in X$.  Therefore, in order to talk about orbits in an abstract set $X$, we need to explicitly define what it means to apply atom permutations to elements of $X$. This is explicit definition is formalised by a group action, as described below. 


\paragraph*{Group actions.} In the following definition, we will be mainly interested in the case where the group $G$ is the group of all atom permutations.  (In later chapters, we will restrict the group to those permutations that respect some extra structure on the atoms, such as a linear order.) 



\begin{definition}[Group action]\label{def:group-action}
    An action of a \emph{group} $G$ on a set $X$ is defined to be a function 
    \begin{align*}
     G \times X \to X,
    \end{align*}
    which we denote by
    \begin{align*}
    (\pi,x) \mapsto \pi(x),
    \end{align*}
    that satisfies the following two axioms: 
    \begin{align*}
    \myunderbrace{(\pi \circ \sigma)(x)}{compose in the group\\ and then apply the action} \quad = \quad \myunderbrace{\pi(\sigma(x))}{apply the action \\ two times} 
    \qquad \text{and} \qquad 
    \myunderbrace{1(x)=x}{the group identity\\ does not move anything}.
    \end{align*}
\end{definition}



\begin{myexample}[Constructors] 
    \label{ex:group-action-constructors}
    We typically construct sets by starting with the atoms, and applying some constructors.  In this case, the constructors will naturally tell us how the group action is defined.  For example, if we have already defined the action on a set $X$, then we can extend it to the power $X^d$, by appling group elements coordinate-wise:
    \begin{align*}
    \pi(x_1,\ldots,x_d) = (\pi(x_1),\ldots,\pi(x_d)).
    \end{align*}
    Similar extensions can be defined for other constructors, such as disjoint unions, powersets, or subquotients
\end{myexample}

The main topic of this book is sets that have finitely many orbits.

\begin{definition}[Orbit]\label{def:orbit}
    Consider a set $X$ equipped with an action of a group $G$. The  ""orbit"" of an element $x \in X$ is the set 
    \begin{align*}
        \setbuild{ \pi(x)}{$\pi$ is an element of $G$}.
    \end{align*}
\end{definition}

\begin{myexample}
    \label{ex:finite-constructions-of-of-sets}
     As we have shown in Lemma~\ref{lem:pof-finitely-many-equivariant}, every "pof set" has finitely many orbits. Another example of a set with finitely many orbits is the set $\atoms^{(d)}$ of non-repeating tuples, which was introduced in Example~\ref{ex:pof-product-generating-set}. This set has exactly one orbit. As we have mentioned before, this is the only kind of one-orbit set that can arise in "pof set". This is because  every orbit in $\atoms^d$ admits an equivariant bijection with a set of the form $\atoms^{(e)}$ for some $e \in \set{1,\ldots,d}$. For example, the orbit of 
    \begin{align*}
    (\john,\mary,\john,\mary) \in \atoms^4
    \end{align*}
admits an equivariant bijection with the set $\atoms^{(2)}$, namely projection onto the first two coordinates. In a subquotiented pof set, we can see other one-orbit sets, such as $\atoms \choose 2$. 
\end{myexample}

\begin{myexample}[Sets which are neither finite nor co-finite]
\label{ex:infinite-co-infinite}
    Consider the family 
    \begin{align*}
    X = \setbuild { Y \subseteq \atoms}{there are infinitely many atoms in $Y$, and also in its complement}.
    \end{align*}
    The family $X$ is naturally equipped with an action of atom permutations. There is exactly one orbit in $X$, because any two sets $Y_1,X_2 \in X$ can be mapped to each other  by an atom permutation. This permutation is constructed by taking a bijection between the atoms in the two sets, and another bijection between the atoms in their complements. Such bijections exist, because the corresponding sets are all countably infinite.
\end{myexample}



\paragraph*{Finite supports.} Judging by the name alone, one would think that an orbit-finite set  is defined to be a set (equipped with the appropriate group action) that has finitely many orbits. This is not, however, the definition that we use, since we will impose an additional requirement. This additional requirement concerns finite supports, which we now explain. The idea is that we only want to allow  finite constructions such as taking pairs or finite sequences (see Example~\ref{ex:finite-constructions-of-of-sets}), and we do not want infinite constructibut it will be inconsistent with infinite constructions such as taking sets that are infinite and co-infinite (see Example~\ref{ex:infinite-co-infinite}). This additional requirement will ensure equivalence with the subquotiented pof sets from the previous section, which will yield a finite representation of orbit-finite sets that can be used by algorithms. Also, we will show that  if this requirement is dropped, then no finite representation is possible.

Let us now define finite supports.
 The general idea is that the support of an  element $x \in X$ consists of  the atoms that are needed to describe $x$. Since the notion is defined in abstract terms of group actions, and  may be hard to grasp immediately, it will be useful to keep the following examples in mind.

\begin{center}
    \begin{tabular}{c|c|c}
        Set $X$ & Element $x \in X$ & Support of $x$\\
        \hline
        $\atoms^2$ & $(\john,\mary)$ & $\john,\mary$\\
        $\powerset \atoms$ & \quad  $\setbuild{a \in \atoms}{$a \neq \john$}$ \quad & $\john$\\
        $\powerset \atoms$ & $\atoms$ & $\emptyset$
    \end{tabular}
\end{center}

Like orbits, one can only talk about supports in the presence of an explicitly defined group action, which must use the group of atom permutations. 
\begin{definition}[Supports]\label{def:supports-equality}
    Consider a set $X$ that is equipped with an action of the group of all  atom permutations. An element $x \in X$ is said to be \emph{supported} by  a list of  atoms $a_1,\ldots,a_n$ if 
    \begin{align}\label{eq:support-defining-implication}
    \myunderbrace{\pi(a_1)=a_1 \land \cdots \land \pi(a_n)=a_n}{we write this as $\pi(\bar a)= \bar a$, where $\bar a$ is the list $a_1,\ldots,a_n$}  
    \quad \Rightarrow \quad 
    \pi(x) = x
    \end{align}
    holds for every atom permutation $\pi$. We say that $x$ is \emph{finitely supported} if it is supported by some finite list of atoms.
\end{definition}

Observe that in the above definition, the group of atom permutation acts on two sets. The first action, which is used in the assumption of implication~\eqref{eq:support-defining-implication}, concerns atoms: an atom permutation is applied to an atom, and the result is another atom.  The second action, which is used in the conclusion of the same implication, concerns the set $X$: an atom permutation is applied to an element of $X$, and the result is another element of $X$. The second action is a parameter of the definition, i.e.~in order for the definition to be meaningful, the set has to come with an action of the group of atom permutations. In most cases of interest, the second action will be clear from the context, when the set is built using  standard constructors, see Example~\ref{ex:group-action-constructors}.  However, in principle when talking about finite supports, we must remember that the notion depends on the action of the group of atom permutations on the set $X$.

Before continuing, let us remark on the notation. In Definition~\ref{def:supports-equality}, supports are finite lists of atoms. The order of atoms in this list, or their repetitions, are not relevant for the notion of support, since they do not affect the assumption of the implication~\eqref{eq:support-defining-implication}. Therefore, the only relevant information is the set of atoms that appears on this list, which is why many authors present the support as a  finite set of atoms, and not a list. If one uses sets $\set{a_1,\ldots,a_n}$ for supports, then one should remember that the assumption in implication~\eqref{eq:support-defining-implication} is not
\begin{align*}
    \pi(\set{a_1,\ldots,a_n}) = \set{a_1,\ldots,a_n},
\end{align*}
which is a weaker assumption, because it allows $\pi$ to swap atoms inside the set.



\begin{myexample}
    Let us discuss which elements of the powerset $\powerset \atoms$ are finitely supported. If $x \in \powerset \atoms$ is finite, then it is finitely  supported, namely it is supported by any list that contains all atoms in this set. A similar result holds for co-finite sets, i.e.~sets obtained by removing finitely many atoms. For example, if we take 
    \begin{align*}
    x = \atoms \setminus \set{\john,\mary},
    \end{align*}
    then  $x$ is  supported by the atoms $\john,\mary$, because any atom permutation that fixes both $\john$ and $\mary$ will map the set $x$ to itself, even if it permutes the other atoms. Therefore, all finite and co-finite elements in $\powerset \atoms$ are finitely supported. 

    The remaining elements of the powerset are not finitely supported.  Let us prove this formally. Suppose that $x \in \powerset \atoms$ is neither finite nor cofinite, and take some hypothetical finite support $\bar a$. There must be some atoms $b,c$ that are not in this finite support, and such that $b \in x$ and $c \not \in x$. Take the atom permutation that swaps $b$ and $c$, and leaves all other atoms fixed. This permutation fixes the support, but moves $x$, which contradicts the definition of finite support.
\end{myexample}

\paragraph*{Orbits and orbit-finiteness.} We are now ready to present  the semantic extension of pof sets that was announced at the beginning of this chapter. 


\begin{definition}[Orbit-finite set]\label{def:orbit-finite-set-equality}
	An \emph{orbit-finite set} is defined to be a set $X$, together with an action of the group of atom permutations, such that every element $x \in X$ has finite support, and there are finitely many orbits. 
\end{definition}

We emphasise once again that, in order for the definition to be meaningful, the action of the group of atom permutations must be explicitly defined on the set $X$. In most examples, this action will be clear from the context, e.g.~if $X$ consists of tuples of atoms.


\begin{myexample}[Powerset is not orbit-finite]\label{ex:powerset-not-orbit-finite}
    The powerset $\powerset \atoms$ is  not an orbit-finite set, for two reasons.
    
    \begin{itemize}
        \item     The first reason is that it contains elements (i.e.~subsets of $\atoms$) which are not finitely supported. For this reason also the set in Example~\ref{ex:infinite-co-infinite} is not orbit-finite, despite having one orbit: its elements are not finitely supported. 
        \item       The second reason is that, even if we restricted the powerset to finitely supported element (the resulting variant of the powerset is called the \emph{finitely supported powerset}), then it still has infinitely many orbits. This is because sets of different finite size are in different orbits. Observe that the elements with infinite support are all in a single orbit, namely the orbit from Example~\ref{ex:infinite-co-infinite}. 
    \end{itemize}
\end{myexample}

\begin{myexample}[Triples modulo cyclic shift]\label{ex:cyclic-triples}
    Consider the set $\atoms^{(3)}$ of non-repeating triples. On this set, consider the equivalence relation that identifies triples modulo cyclic shift: 
    \begin{align*}
    (a,b,c) \sim (b,c,a) \sim (c,a,b) \quad \text{for all $a,b,c \in \atoms$}.
    \end{align*}
    Consider the quotient of under this equivalence relation. This is a one-orbit set. It is also an example of a subquotiented pof set, since we can view $\sim$ as a partial equivalence relation on (possibly repeating) triples that removes the repeating triples. 
\end{myexample}




The positive examples we have seen above were examples of subquotient pof sets. This is not a coincidence: as we have announced at the beginning of this chapter, the semantic notion of orbit-finite sets from this section is equivalent to the syntactic notion of subquotient pof sets from the previous section.

\begin{theorem}\label{thm:subquotiented-pof-representation} 
    Let $X$ be a set equipped with an action of atom permutations. Then $X$ is orbit-finite if and only if it admits an equivariant bijection with a subquotient pof set.
\end{theorem}
\begin{proof}
    The bottom-up implication is easy, so we only prove the top-down implication. If a set has finitely many orbits, then it is a disjoint union of finitely many one-orbit sets. Since subquotient pof sets are closed under finite disjoint union, it is enough to prove the top-down implication for a one-orbit set $X$.
    
    Let then $X$ be a one-orbit set. Choose some $x \in X$. By assumption on finite supports, this element is supported by finitely many atoms $a_1,\ldots,a_d$. Consider the orbit of the pair 
$
((a_1,\ldots,a_d),x),
$
    which is the set
    \begin{align*}
    \setbuild{(\pi(a_1,\ldots,a_d),\pi(x))}{$\pi$ is an atom permutation}.
    \end{align*}
    This set can be seen as a binary relation between $\atoms^d$ and $X$. It is equivariant by definition, since it is the orbit of some pair.  The binary relation is in fact a partial function, i.e.~for every input from $\atoms^d$  there is at most one output from $X$ that is related to it; this is by definition of supports. The function is partial, because its domain is a single orbit inside $\atoms^d$, namely the  orbit of $(a_1,\ldots,a_d)$. (We could make the function total by restricting it to its domain, but then the domain would cease to be a pof set, while the theorem asks for a subquotient pof set.) The range of the function is the orbit of $x$, and therefore the function is surjective, since we have assumed that $X$ is a one-orbit set.
    
    So far, we have found a partial function of type $\atoms^d \to X$ that is equivariant and surjective. We will now improve by quotienting the input with respect to the partial equivalence relation on $\atoms^d$ that is  defined by 
    \begin{align*}
    \bar a \sim \bar b
    \quad \text{if} \quad
    \text{$f(\bar a)$ and $f(\bar b)$ are both defined an equal to each other.}
    \end{align*}
    After this subquotient, the function becomes total (because we have removed the inputs that have undefined outputs) and a bijective (because we have identified inputs that have the same output), as required by the theorem. 
\end{proof}


\paragraph*{Why finite supports?} We finish this section by explaining why Definition~\ref{def:orbit-finite-set-equality} requires every element in an orbit-finite set to have finite support.  One answer is that in the proof of Theorem~\ref{thm:subquotiented-pof-representation}, we used finite supports, to choose the atoms  $a_1,\ldots,a_d$. Let us now give a more thorough explanation, by showing that without the finite support, not only does the representation from Theorem~\ref{thm:subquotiented-pof-representation} fail, but also any other  finite representation will fail.  Therefore, without finite supports, the definition of orbit-finiteness becomes useless.

We begin our discussion with a study of the orbits in $\atoms^\omega$, which is a natural example of a set without finite supports. As we will see, the orbits in this set are relatively tame, and more refined examples are needed to understand the finite support requirement.





\begin{myexample}[Orbits in $\atoms^\omega$]
    Consider the set $\atoms^\omega$ of infinite sequences of atoms. This set uncountably many orbits. Even if we consider sequences that use only two atoms, such as 
\begin{align*}
(\john,\eve,\john,\eve,\john,\eve,\ldots),
\end{align*}
then the pattern in which the two atoms are distributed in the sequence can be chosen in uncountably many ways, and each such pattern will be a different orbit.  However, as we will see, there will be only countably many kinds of orbits, if we identify two orbits that admit an equivariant bijection with each other. 

For example, if we take any sequence that uses exactly $d$ atoms, then the orbit of this sequence will admit an equivariant bijection with the set $\atoms^{(d)}$. (Note that a sequence which uses $d$ atoms is finitely supported, namely by the atoms that appear in it, despite the fact that the sequence has infinite length, and therefore some atoms  are repeated infinitely often in it.) In particular, all  orbits that use exactly $d$ atoms will be the same, up to equivariant bijections. Since the number $d$ can be chosen in countably many ways, it follows that, up to equivariant bijections, there are countably many orbits that use finitely many atoms. These orbits will be the ones that have finitely supported elements. 

Let us now consider the orbits in which the sequences use infinitely many atoms, i.e.~orbits whose elements are not finitely supported. For a sequence define its profile to be the following information: (a) how many distinct atoms appear in the sequence, and (b) how many distinct  atoms do not appear in the sequence. The profile can be chosen in countably many ways. Furthermore, one can show that if two sequences have the same profile, then their orbits will admit an equivariant bijection with each other. It follows that, up to equivariant bijections, there are countably many orbits in $\atoms^\omega$.
\end{myexample}

In the above example, we have only succeeded to find countably many one-orbit sets, up to equivariant bijections.  This is rectified in the following example, which will have uncountably many such sets.

\begin{myexample}[Orbits of equivalence relations]
    Consider the set 
    \begin{align*}
     \text{all equivalence relations on $\atoms$}.
    \end{align*} 
    The equivalence relations are not required to be finitely supported. (An equivalence relation is finitely supported if and only if it has one equivalence class that is co-finite.) An equivalence relation is a set of pairs of atoms, and therefore one can apply an atom permutation to an equivalence relation, yielding a new equivalence relation. Therefore, it is meaningful to talk about orbits of equivalence relations. There are uncountably many different orbits. For example, if two equivalence relations are in the same orbit, then they must agree on the following information: what is the set of possible sizes of equivalence classes. Since this information can be chosen in uncountably many ways, it follows that there are uncountably many orbits. 

    We will now show that for every two different orbits, there cannot be an  equivariant bijection between them.  This will show that, even up to equivariant bijections, there are uncountably many different orbits in our set. The key observation is that an equivalence relation $\sim$ can be identified by looking at its stabiliser, i.e.~the set of atom permutations that fix it. This is because  
    \begin{align}
        \label{eq:equivalence-relation-stabiliser}
    a \sim b 
    \quad \Leftrightarrow \quad
    \myunderbrace{\pi(\sim) = \sim \text{for the atom permutation that swaps $a$ and $b$.}}{the atom permutation that swaps $a$ with $b$ belongs to the stabiliser of $\sim$}
    \end{align}
Stabilisers behave in a very predictable way under equivariant functions, namely they can only increase, as the following claim asserts.
    \begin{claim}\label{claim:equivariant-inclusion-stabiliser}
        Let $f : X \to Y$ be an equivariant function, not necessarily a bijection. Then 
        \begin{align*}
        \text{stabiliser of $x$} \subseteq  \text{stabiliser of $f(x)$} 
        \qquad \text{for every $x \in X$.}
        \end{align*}  
    \end{claim}
    \begin{proof}
        If $\pi$ is in the stabiliser of $x$, i.e.~$\pi(x)=x$, then $\pi(f(x))= f(\pi(x))= f(x)$ by equivariance, and therefore $\pi$ is also in the stabiliser of $f(x)$. 
    \end{proof}
    In particular, if the function $f$ is a bijection, then both $f$ and its inverse can only increase the stabilisers, which means that the stabilisers do not change along $f$. This, together with the observation from~\eqref{eq:equivalence-relation-stabiliser}, which says that stabilisers uniquely determine equivalence relations, we infer that an equivariant bijection between two orbits of equivalence relations can only be the identity. 
\end{myexample}

As shown in the above example, if we allow elements without finite supports, then a one-orbit set can be defined in uncountably many different ways, even up to equivariant bijections. In particular, there cannot be any finite representation of one-orbit sets without finite supports, unlike the representation from Theorem~\ref{thm:subquotiented-pof-representation} that we have seen above. This is why the definition of orbit-finiteness requires finite supports. 

 

\section{A Myhill-Nerode Theorem}
\label{sec:myhill-nerode-equality}
We now use the theory developed above to prove an orbit-finite version of the Myhill-Nerode Theorem. In the classical, finite version, the theorem says that a language is regular if and only if its syntactic congruence has finite index (i.e.~finitely many equivalence classes), with the syntactic congruence defined as follows. 
\begin{definition}[Syntactic congruence]
    \label{def:syntactic-congruence}
    The \emph{syntactic congruence} of a language $L \subseteq \Sigma^*$ is the equivalence relation on $\Sigma^*$ that identifies two words $w$ and $w'$ if they cannot be distinguished by any future, i.e.
    \begin{align*}
    wv \in L \Leftrightarrow w'v \in L \qquad \text{ for every $v \in \Sigma^*$.}
    \end{align*}
\end{definition}

The syntactic congruence can be applied also for infinite alphabets, such as subquotient pof sets. We will show that in this case, orbit-finite index will correspond to being recognised by a deterministic subquotient pof automaton. 


We begin by explaining what it means for the syntactic congruence to have orbit-finite index. The first observation is that the syntactic congruence is equivariant, as long as the language itself is equivariant.

\begin{lemma}
    Let $\Sigma$ be a subquotient pof set. If a language $L \subseteq \Sigma^*$ is equivariant, then the same is true for its syntactic congruence, i.e.
    \begin{align*}
    w \sim w' 
    \quad \Leftrightarrow \quad
    \pi(w) \sim \pi(w')
    \end{align*}
    for every pair of words $w,w' \in \Sigma^*$ and every atom permutation $\pi$.
\end{lemma}
\begin{proof}
    If the words $w$ and $w'$ can be distinguished by some future $v$, then the words $\pi(w)$ and $\pi(w')$ can be distinguished by the future $\pi(v)$, thanks to equivariance of concatenation and of the language $L$.
\end{proof}

We now explain why the notion of orbits is applicable to the quotient of $\Sigma^*$ under the syntactic congruence.  
Consider some set $X$ with an action of atom permutations (we care about $X = \Sigma^*$ in this example). Let $\sim$ be an equivalence relation on this set that is equivariant (we care about the syntactic congruence). The quotient $
X_{/\sim}$
is also equipped with an action of atom permutations, with the action defined by 
\begin{align}\label{eq:action-on-equivalence-classes}
\text{equivalence class of $x$}
\quad \stackrel \pi \mapsto \quad 
\text{equivalence class of $\pi(x)$}.
\end{align}
By equivariance of $\sim$, it is easy to check that this action is well-defined, i.e.~it does not depend on the choice of representative $x$ in the equivalence class.
Thanks to the above observations, if $\Sigma$ is a subquotient pof set, and $L \subseteq \Sigma^*$ is an equivariant language, then we can equip the quotient 
\begin{align*}
\Sigma^*_{/ \text{syntactic congruence of $L$}}
\end{align*}
with an action of atom permutations, and therefore we can ask if this quotient is orbit-finite. As the following theorem shows, orbit-finiteness is equivalent to recognizability by a deterministic spof automaton.

\begin{theorem}\label{thm:myhill-nerode-subquotiented-pof}
    The following conditions are equivalent for an equivariant language $L \subseteq \Sigma^*$ over a spof alphabet $\Sigma$:
    \begin{enumerate}
        \item\label{item:myhill-nerode-recognised} $L$ is recognised by a deterministic spof automaton;
        \item\label{item:myhill-nerode-orbit-finite} the quotient of $\Sigma^*$ under the syntactic congruence of $L$ is orbit-finite.
    \end{enumerate}
\end{theorem}
\begin{proof} We use essentially the same proof as in the classical Myhill-Nerode Theorem, except that we use ``orbit-finite'' instead of ``finite''.

    \begin{description}
        \item[\ref{item:myhill-nerode-recognised} $\Rightarrow$ 
        \ref{item:myhill-nerode-orbit-finite}]     Let us first show that if $L$ is recognised by a deterministic spof automaton, then the quotient from item~\ref{item:myhill-nerode-orbit-finite} is orbit-finite. Let $Q$ be the reachable states of the automaton. If two words give the same state of the automaton, then they must be equivalent under the syntactic congruence. This gives us a function from $Q$ to the equivalence classes of the syntactic congruence. This function is surjective, since every word gives some state, and it is easily seen to be equivariant. Therefore, we can deduce orbit-finiteness of the syntactic congruence by applying the following straightforward lemma.
    
        \begin{lemma}
            Let $f : X \to Y$ be a surjective equivariant function between two sets equipped with actions of atom permutations. If $X$ is orbit-finite, then so is~$Y$.
        \end{lemma}
        \begin{proof}
            Every orbit of $X$ is mapped to an orbit of $Y$.
        \end{proof}

        \item[\ref{item:myhill-nerode-orbit-finite} $\Rightarrow$
        \ref{item:myhill-nerode-recognised}] We use the standard syntactic automaton whose state space is the quotient of $\Sigma^*$ under syntactic congruence, and whose transition function is given by 
        \begin{align*}
        \text{equivalence class of $w$} 
        \quad 
        \stackrel{a}{\longrightarrow}
        \quad
        \text{equivalence class of $wa$}.
        \end{align*}
        We will justify that this is indeed a spof automaton. 
        Directly from the definition of the action on the subquotient described in~\eqref{eq:action-on-equivalence-classes}, we deduce that quotienting preserves finite supports: if a tuple of atoms  supports a word $w \in \Sigma^*$,  then the same tuple supports its equivalence class  under syntactic congruence. Therefore, every element in the quotient has a finite support. By Theorem~\ref{thm:subquotiented-pof-representation}, the quotient is isomorphic to a spof set. 
    \end{description}
\end{proof}

In the theorem above, we use spof sets. What about pof sets (without subquotients), as discussed at the beginning of this book? If the input alphabet is non-trivially quotiented, then we will also need quotients for the state space of the automaton, as explained in the following example.

\begin{myexample}
    Consider the input alphabet 
    \begin{align*}
        \Sigma = {\atoms \choose 2},
        \end{align*}
    and a deterministic pof automaton (without subquotients). We claim that in this automaton, all reachable states will have atom dimension zero, i.e.~they will come from atom-free components $\atoms^0$.   To see why this is true, we use the following observation.
    \begin{lemma}\label{lem:no-choice}
        Let $d > 0$. 
        There is no equivariant function 
        \begin{align*}
        f : {\atoms \choose 2} \to \atoms^d.
        \end{align*}
    \end{lemma}
    Thanks to the observation in the above lemma, if the current state is of atom dimension zero, then the next state also has this property. Therefore, the reachable states of the automaton have atom dimension zero. This will preclude recognizing any language that depends on atoms in any way.
\end{myexample}

The above example shows that we may need quotients if the input alphabet has quotients. But what if the input alphabet  is a pof set without any quotients?   As we will see later in this chapter, the Myhill-Nerode Theorem does hold in this case, because we have an implication 
\[
\begin{tikzcd}
\txt{recognised by a subquotient pof automaton  and input alphabet is a pof set}  \ar[d,Rightarrow] \\ \txt{recognised by a pof automaton}.
\end{tikzcd}
\]
However, proving this implication will require developing some extra theory, namely the existence of least supports. 

\exercisepart
\input{problems/spof-groups}

\section{Least supports}
\label{sec:least-support}
An element of a set might have different supports. For example, we can add atoms to a support, and it will still be a support. In this section, we show that adding useless atoms to the support is the only phenomenon that can arise, because there will always exist a least support\footnote{The Least Support Theorem was first proved in~\cite[Proposition 3.4]{DBLP:journals/fac/GabbayP02}. A generalisation of this theorem, for other kinds of atoms, can be found in~\cite[Section 10]{DBLP:journals/corr/BojanczykKL14}.}. 

\begin{theorem}[Least Support Theorem] \label{thm:least-supports} Let $X$ be a set with an action of atom permutation. If $x \in X$ has some finite support, then one can find   atoms  $a_1,\ldots,a_d$ that support $x$, and such that every finite support of $x$ contains all atoms $a_1,\ldots,a_d$.
\end{theorem}

Another way of stating the above theorem is that finite supports are closed under intersection, if they are viewed as sets (and not lists).
 It is important that we consider finite supports. For example, any atom $a$ is supported by the cofinite set $\atoms - \set a$, since fixing the cofinite set is the same as fixing $a$. The intersection of the two supports $\set a$ and $\atoms - \set a$ is empty, but $a$ does not have empty support. 
\begin{proof}[Proof of the Least Support Theorem] It is enough to prove the theorem in the case when $X$ has one orbit. This is because every other set is a disjoint union  of (possibly infinitely many) one-orbit sets. 
    Recall the set  $\atoms^{(d)}$ of non-repeating tuples that was described in Example~\ref{ex:subquotiented-as-subsets}. This is an equivariant one-orbit set. The key observation is the following lemma.

\begin{lemma}\label{lem:tuple-as-set}
    Assume that $X$ has one orbit. There is some $d \in \set{0,1,\ldots}$ and an equivariant surjective function
 \begin{align*}
 f : \atoms^{(d)} \to X 
 \end{align*}
 such that tuples with the same value under $f$ are equal as sets:
 \begin{align*}
 f(a_1,\ldots,a_d) = f(b_1,\ldots,b_d) \qquad \text{implies} \qquad \set{a_1,\ldots,a_d}= \set{b_1,\ldots,b_d}.
 \end{align*}
\end{lemma}
\begin{proof}
 By Theorem~\ref{thm:subquotiented-pof-representation}, $X$ admits an equivariant bijection with a spof set. This means that there is an equivariant surjective function from a  pof set $Y$ (without subquotients) to $X$. 
 Take some equivariant orbit of this function, with the function viewed as a subset of $Y \times X$. This orbit is still an equivariant function whose image is also $X$. This way, we can assume without loss of generality that $Y$ is a single equivariant orbit in a set of the form $\atoms^d$. Such an orbit is an equality type. By projecting away the duplicated coordinates in the equality type, we can assume that $Y$ contains only non-repeating tuples. Summing up, we know that there is a surjective equivariant function
 \begin{align*}
 f : \atoms^{(d)} \to X.
 \end{align*}
 We show below that the function either satisfies the condition in the statement of the lemma, or the dimension $d$ can be made smaller. If the condition in the statement of the lemma is not satisfied, then 
 \begin{align}\label{eq:not-equal-as-sets}
 f(a_1,\ldots,a_d) = f(b_1,\ldots,b_d) 
 \end{align}
 holds for some tuples $\bar a, \bar b$ which are not equal as sets. Without loss of generality, we assume that the last atom $a_d$ in $\bar a$ does not appear in the tuple $\bar b$. Choose some 
 atom permutation $\pi$ which fixes the first $d-1$ atoms in $\bar a$ and all atoms in $\bar b$, but does not fix the last atom $a_d$ in $\bar a$. We have 
 \begin{eqnarray*}
 f(\bar a) \stackrel{\text{\eqref{eq:not-equal-as-sets}}} =
 f(\bar b) \stackrel{\text{$\pi$ fixes $\bar b$}} = 
 f(\pi(\bar b))\stackrel{\text{equivariance}} = 
 \pi(f(\bar b)) \stackrel{\text{\eqref{eq:not-equal-as-sets}}} = 
 \pi(f(\bar a)) \stackrel{\text{equivariance}} =
 f(\pi(\bar a)),
 \end{eqnarray*}
which proves that 
 \begin{align*}
 f(a_1,\ldots,a_{d-1},a_d) = f(a_1,\ldots,a_{d-1},a) \qquad \text{for some distinct $a,a_1,\ldots,a_d$.}
 \end{align*}
 The set of tuples $a,a_1,\ldots,a_d$ which satisfies the condition above is an equivariant subset of $\atoms^{(d+1)}$, by equivariance of $f$. Therefore, if some tuple satisfies the condition, then all tuples in $\atoms^{(d+1)}$ satisfy it as well, i.e.~we could also write ``for all distinct'' in the above condition.
 In other words, the value of $f$ depends only on the first $d-1$ coordinates. Therefore, we can use the induction assumption. 
\end{proof}

Using the above lemma, we complete the proof of the  Least Support Theorem.  Apply Lemma~\ref{lem:tuple-as-set}
yielding some equivariant function
\begin{align*}
 f : \atoms^{(n)} \to X.
\end{align*}
Let $x \in X$, and choose  some tuple $(a_1,\ldots,a_n)$ which is mapped by $f$ to $x$. To prove the Least Support Theorem, we will show that the atoms $a_1,\ldots,a_n$ appear in every support of $x$. Let then $\bar b$ be some atom tuple which supports $x$. Toward a contradiction, suppose that $\bar b$ is not a permutation of $a_1,\ldots,a_d$, and therefore one can choose atom permutation $\pi$ such that 
\begin{align*}
\pi(b_i) & = b_i \quad \text{for every $i \in \set{1,\ldots,d}$}\\
\pi(a_i) & \not \in \set{a_1,\ldots,a_d} \quad \text{for some $i \in \set{1,\ldots,d}$.}
\end{align*}
We have 
\begin{eqnarray*}
 x &=\quad & \text{\small($\pi$ fixes the support of $x$)}\\ 
 \pi(x) &=\quad & \text{\small(choice of $a_1,\ldots,a_d$)}\\ 
 \pi(f(a_1,\ldots,a_d)) &=\quad & \text{\small(equivariance of $f$)}\\
 f(\pi(a_1,\ldots,a_d)).
\end{eqnarray*}
Since the tuple $\pi(a_1,\ldots,a_n)$ is not equal to $(a_1,\ldots,a_n)$ as a set, it must have a different value than $x$, by assumption on the function $f$. 
\end{proof}



\subsection*{A representation theorem} Apart from the Least Support Theorem, another application of Lemma~\ref{lem:tuple-as-set} is the following representation theorem for equivariant orbit-finite sets.
Let $X$ be a one-orbit set. Apply Lemma~\ref{lem:tuple-as-set}, yielding an equivariant function
 \begin{align*}
 f : \atoms^{(d)} \to X.
 \end{align*}
 Because $f$ is equivariant and permutations of coordinates commute with atom automorphisms, the following conditions are equivalent for every permutation $g$ of the coordinates $\set{1,\ldots,d}$:
 \begin{eqnarray}
 \label{eq:perm-some} f(a_1,\ldots,a_d) = f(a_{g(1)},\ldots,a_{g(d)}) & & \text{for some $(a_1,\ldots,a_d) \in \atoms^{(d)}$}\\
 \label{eq:perm-all} f(a_1,\ldots,a_d) = f(a_{g(1)},\ldots,a_{g(d)}) & & \text{for every $(a_1,\ldots,a_d) \in \atoms^{(d)}$}.
 \end{eqnarray}
 Permutations $g$ which satisfy condition~\eqref{eq:perm-all} form a group, call it $G$. This is a subgroup of the group of permutations of the coordinates $\set{1,\ldots,d}$.  We claim:
 \begin{eqnarray*}
 f(a_1,\ldots,a_d) &=& f(b_1,\ldots,b_d)\\ & \text{iff} & \\ \exists g \in G\ (a_1,\ldots,a_d)&=& (b_{g(1)},\ldots,b_{g(d)}).
 \end{eqnarray*}
 The bottom-up implication is by definition. For the top-down implication, recall that Lemma~\ref{lem:tuple-as-set} asserted that tuples with the image under $f$ must contain the same atoms, and therefore some $g \in G$ must take one tuple to the other. 
 Let us write
$$\atoms^{(d)} /_G$$ to be $\atoms^{(d)}$
for the set of non-repeating atom tuples modulo coordinate permutations from the group $G$. Since quotienting by $G$ is exactly the kernel of the function $f$, we have just proved the following theorem\footnote{This result is from~\cite[Theorem 10.17]{DBLP:journals/corr/BojanczykKL14}, although a similar construction can already be found in~\cite[Definition 2]{DBLP:conf/fossacs/FerrariMP02}. 
}:
\begin{theorem}\label{thm:classify-one-orbit} Let $X$ be an orbit-finite set that has one orbit. 
Then $X$  admits an equivariant bijection to a set of the form $$\atoms^{(d)} /_G$$ for some $d \in \Nat$ and some subgroup $G$ of the group of permutations of the set $\set{1,\ldots,d}$.
\end{theorem}
\begin{myexample}
 Let $d \in \set{1,2,\ldots}$ and let $G$ be the group of all permutations of $\set{1,\ldots,d}$. In this case, $\atoms^{(d)} /_G$ is the same as 
 \begin{align*}
 {\atoms \choose d},
 \end{align*}
 i.e.~unordered sets of atoms with exactly $d$ elements. 
\end{myexample}




\subsection*{Myhill-Nerode for pof sets}
As we have mentioned after the proof of the Myhill-Nerode characterization in Theorem~\ref{thm:myhill-nerode-subquotiented-pof}, in the case of pof sets without subquotients, deterministic pof automata are equivalent to deterministic  spof automata. This is proved below.
\begin{theorem}\label{thm:myhill-nerode-pof}
    Assume that the input alphabet is a pof set $\Sigma$ (without subquotients). Then the two equivalent conditions in Theorem~\ref{thm:myhill-nerode-subquotiented-pof} are also equivalent to 
    \begin{enumerate}
        \item[(3)]\label{item:myhill-nerode-pof-recognised} $L$ is recognised by a deterministic pof automaton.
    \end{enumerate}
\end{theorem}
\begin{proof}
    Since pof sets are a special case of subquotient pof sets, it is enough to show that if the input alphabet is a pof set (without subquotients), then the subquotients can be removed from deterministic automata: for every deterministic spof automaton, there is an equivalent  deterministic pof automaton. Consider a deterministic subquotient pof automaton. Let $Q$ be its state space. By Theorem~\ref{thm:classify-one-orbit}, we can assume that the state space is 
    \begin{align*}
Q =     \sum_{i \in I} \atoms^{(d_i)} / G_i
    \end{align*}
    Consider the pof set 
    \begin{align*}
    P = \sum_{i \in I} \atoms^{d}.
    \end{align*}
    There is a natural projection from $P$ to $Q$, which is a partial function 
    \begin{align*}
    \Pi : P \to Q.
    \end{align*}
This projection is  defined on elements with non-repeating tuples of atoms, and it returns the corresponding equivalence class. An important property of this projection is: 
\begin{enumerate}
    \item[(*)] every output element arises from finitely many input elements. 
\end{enumerate}
Let us pull back the transition function of the original automaton to a transition relation on states $P$. In other words, define 
\begin{align*}
\Delta \subseteq P \times \Sigma \times P 
\end{align*}
to be the inverse image, under the projection $\Pi$, of the transition function of the original automaton. We view $\Delta$ as a binary relation between two pof sets, namely $P \times \Sigma$ and $P$. Because the original automaton was deterministic,  and thanks to the finiteness condition (*), we know that for every input in $P \times \Sigma$, the transition relation $\Delta$ has finitely many outputs in $P$. Therefore, we can apply the following lemma to extract an equivariant function contained in $\Delta$.


    \begin{lemma}\label{lem:uniformization-pof}
        Let $X$ and $Y$ be pof sets, and let  $\Delta \subseteq X \times Y$ be an equivariant binary relation such that for every $x \in X$ the set 
        \begin{align*}
        \setbuild{ y \in Y}{$(x,y) \in \Delta$}
        \end{align*}
        is nonempty and finite. Then there is an equivariant function $\delta : X \to Y$ whose graph is contained in $\Delta$.
    \end{lemma}
    \begin{proof}
        We first observe that for every pair $(x,y) \in \Delta$, every atom that appears in the output $y$ must also appear in the input $x$. This is because if the output would contain some fresh atom, i.e.~some atom that does not appear in the input, then by equivariance of the relation we could replace this fresh atom by infinitely many other choices. This would  contradict the assumption that there are finitely many outputs for every input. 

        Decompose the set $\Delta$ into orbits: 
        \begin{align*}
        \Delta = \Delta_1 \cup \cdots \cup \Delta_n.
        \end{align*}
        We will now show that each of these orbits  is an "equivariant" partial function from $X$ to $Y$. Clearly each orbit is "equivariant". To show that the orbits are partial functions, we must show that if we take two pairs 
        \begin{align*}
        (x_1,y_1), (x_2,y_2)
        \end{align*}
        that are in the same orbit $\Delta_i$, and their inputs $x_1$ and $x_2$ are equal, then their outputs $y_1$ and $y_2$ must also be equal. Indeed, by the observations from the previous paragraph, all atoms appear in the output must appear also in the input. By the assumption that the two pairs are in the same orbit, it follows that the "component" must be the same in the outputs $y_1$ and $y_2$, and also the way that output coordinates are filled with input  atoms  must be the same. Since all atoms are copied from the input, and the inputs are the same, it follows that the two outputs are the same. 

        We will now select some orbits of $\Delta$ so that they sum up to a total equivariant function from $X$ to $Y$.
        If we project an orbit of $\Delta$ to its first (input) coordinate, then we get an orbit of $X$. By the assumption that every input has at least one output, we know that each orbit of $X$ arises as  the projection of at least one orbit of $\Delta$. Choose for each orbit of $X$ exactly one orbit of $\Delta$ that projects to it. As we have argued in the previous paragraph, this chosen orbit is a partial function from $X$ to $Y$. Since we have chosen the orbits so that every input is covered exactly once, by summing up these orbits we obtain a total equivariant function from $X$ to $Y$.
    \end{proof}
\end{proof}








